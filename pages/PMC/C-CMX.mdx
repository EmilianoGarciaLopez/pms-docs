---
title: PMC-C-CMX
subtitle: Application documentation and guidance for PMC-C-CMX Pi control board, the first Pi carrier with M.2 PCIe 3.0 support and a powerful real-time controller STM32H7.
---

# PMC Series controllers: CMX platform for Pi CM4/5 SoMs

![PMC-C-CMX](/images/pmc/pmc-c-cmx_frontunprofessional.jpg)

## Overview


## Powering the controller

The PMC-C-CMX can be powered through the terminal block or USB-C PD input.

**Definitions used**

INPUT bus: The common high-voltage power bus containing the input voltage, which feeds the converter system and branches on the modular bus.
VBUS/USB voltage: The voltage presented by the USD-PD source, may or may not be connected to INPUT bus


### Wire/Terminal input

- 7-55V input range (10A max)

The PMC-C-CMX allows a wire to be inserted into a press-fit terminal block without a screwdriver to deliver up to 55V at 10A. Pin 1 on the terminal block, labeled 7-55VIN is connected to INPUT bus through a simple protection circuit, capable of 10A continuous. The board is designed to hande a total of 12A running through the bus connector continuously under a 20C temperature rise.

#### Minimum power requirements

The onboard converters can reliably function at as little as 7V and the CM4 TDP at full load is not to exceed 15 watts. A minimum power requirement of 7V @ 2.5A is derived. This does not account for peripherals such as USB devices, cameras on the INPUT or 5V/3V3 busses. The latter of which are capped at 30W/18W INPUT bus power draw, respectively. 

Below are recommended power supply ratings for minimum, and fully-loaded configurations (additional power draw from the modular bus is not considered)


| Input  | Min.  | Full  |
| ------ | ----- | ----- |
| 7V     | 2.5A  | 9.5A  |
| 12V    | 1.6A  | 6.0A  |
| 24V    | 0.7A  | 2.8A  |
| 48V    | 0.4A  | 1.5A  |


### USBC PD input

- Supports USB PD 2.0 with up to 45W power profiles
- User-programmable power delivery profiles\*\*\*

The PMC-C-CMX includes a USB-PD 2.1 sink controller, the STUSB4500 by STMicroelectronics. Conforming to the USB-PD 2.1 standard, it allows the entire controller system to be powered by a capable PD charger at up to 100W (20V@5A). A bidirectional current switch capable of blocking the maximum INPUT bus voltage of 60V is controlled by the STUSB chip. 

The controller is shipped with a solder-bridge shorted, connecting the VBUS output directly to INPUT bus. It is provided in the case that separate INPUT bus and USB-PD inputs are desired. Otherwise, it is OK to leave the jumper bridged under any power configuration. The voltage on INPUT bus will simply be the higher of the USB-PD voltage or the terminal input voltage. See the below section on dual inputs for more information.

#### Default NVMe configuration

The STUSB4500 is pre-flashed with registers set for a PD configuration that will work out of the box for most users and power supplies. The chip has three Power Delivery Objects (PDOs):

| Defaults | VBUS  | Imin   |
| -------- | ----- | ------ |
| PDO3     | 20V   | 1.00A  |
| PDO2     | 15V   | 1.75A  |
| PDO1     | 5V    | OFF    |

(PDO 1 is 5V, and cannot be changed)

The order the PDOs are listed is also the precedence of the PD negotiation. STUSB will request PDO3 first, and if available will take PDO3. If using a 20V-capable charger but a lower bus voltage is desired (15V, 9V), the NVM must be reflashed.

As the minimum system INPUT bus voltage is 7V, the 5V PDO on the chip is disabled on the configuration it is shipped with. 

#### Flashing the STUSB NVM

The NVM parameters can be configured by flashing the STUSB controller through its programming header. The pinout is given below:


![STUSB4500 interface pinout](/images/pmc/USB-PDinterface_pindiagram.svg)

The STUSB4500 can be flashed with the onboard CM4's GPIO, or the onboard STM32H7. However if it is undesirable to change firmware/software deployments a simple external flasher with any AVR platform board such as an Arduino can be used to flash the NVM. A connection diagram and CPP code for flashing the default configuration is given below. Please note that it does require the Softwire library and it's dependancies, found at stevemarple/softwire.

| Arduino UNO R3 | USB-PD interface |
| -------------- | ---------------- |
| GND            | G                |
| 3V3            | V+               |
| A4             | SC               |
| A5             | SD               |

Please note that a 2.2k-10k pullup resistor is required between A4/3V3, and A5/3V3.

### Using dual inputs

The PMC-C-CMX board can work with any combination of valid terminal input and USB-PD inputs together without posing hazard to the controller, or the upstream USB power supply. This means that using both a power input through the terminal and a USB-PD charger forms an implicitly redundant power scheme. If any one method fails, the system will automaticall failover to the other power input. The voltage on INPUT bus will always be the higher of the two power inputs. 

It is recommended to add a large (470-2200uF) smoothing/reserve capacitor on the INPUT bus when using dual inputs for redundancy.

## Compute Module

The PMC-C-CMX features a Raspberry Pi Compute Module 4 or 5 (CM4/CM5). 

- 2x HDMI 4k60p 1.4b
- 2x2 MIPI CSI/DSI (3/5 Lane)
- 4, 3 or 1 native USB 2.0 ports\*
- PCIe 3.0 8GT/s support
- M.2 B-Key and M-Key form factor support (30x30/42/80mm)

### Flashing the OS

The CM4/5 can be flashed with an operating system in multiple ways:

#### USB flashing

Connect the board via USB and use the Raspberry Pi usbboot utility to flash the eMMC.

#### Preloading with SD card (non-CM4Lite only)

For full CM4 modules with SD card support, you can preload the OS image onto a microSD card. Insert it into the module before powering on.

### Using M.2 PCIe devices

The PMC-C-CMX M.2 slot supports NVMe SSDs for additional storage. The Samsung 990 EVO has been confirmed as bootable. Cellular modems with a nano-SIM slot are also supported in the B-key slot.

#### Configuring cellular support

Cellular modem functionality can be configured in the host operating system running on the CM4/5. Consult the modem manufacturer's documentation for setup instructions.

### GPIO mapping and using HATs

The PMC-C-CMX breaks out the CM4/5's GPIO to a 40-pin header compatible with the Raspberry Pi HAT specification. Refer to the provided GPIO mapping table for pins used by onboard functionality. Unused GPIOs can interface with custom or off-the-shelf HATs.

### Video interfaces

Dual HDMI and 4-lane MIPI DSI allow connection of up to two 4k60 displays or high resolution MIPI displays. The 2-lane MIPI CSI interfaces enable use of compatible cameras.

### Real-time clock

An onboard PCF85063AT RTC chip with crystal maintains date/time when the system is powered off. It supports wake-on-alarm and interrupt functionality.

### RS-485 Profibus-DP compatible transceiver

The high-speed RS-485 transceiver supports speeds up to 20Mbps, suitable for PROFIBUS-DP industrial networks. TX/RX are on GPIOs 12/13.

## STM32H7 controller

An onboard STM32H7B0 microcontroller enables real-time IO control and offloads the CM4/5. It features:

- 128KB flash / 1.4MB RAM
- 280MHz max clock speed
- 16MHz and 32.768kHz crystals
- 58 total GPIOs (4x16 + 1x8)

### Flashing firmware

#### Using the SWD header

An 8-pin header exposes the STM32's SWD interface for flashing and debugging using an ST-LINK or compatible probe.

#### Using the UART bootloader (OTA)

The STM32 supports flashing over its UART interface. A bootloader program running on the CM4/5 can send the firmware image.

### GPIO mapping

Refer to the STM32H7 GPIO table for pinout. All GPIOs are tolerant to 25kV ESD per IEC 61000-4-2.

## PMC modular bus

The PMC modular bus allows connection of PMC IO modules for additional functionality.

### SPI control

SPI control signals (CS, CLK, MISO, MOSI) allow high-speed communication with PMC modules at up to 24Mbps.

### I^2C control

#### GPIO expander

An I2C GPIO expander allows control of module-specific functions. The interface supports 2Mbps speed.

## Common questions
